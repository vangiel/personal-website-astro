---
import { Icon } from "astro-icon/components";
---

<button id="themeToggle">
	<Icon name="themes/republic" class="dark-icon" />
	<Icon name="themes/rebel" class="light-icon" />
	<span class="visually-hidden sr-only"></span>
</button>

<style>
	#themeToggle {
		width: 32px;
		aspect-ratio: 1;
		cursor: pointer;
		border: none;
		background: transparent;
	}

	.dark-icon {
		height: 100%;
		width: 100%;
		display: none;
		color: var(--clr-text);
	}

	.light-icon {
		height: 100%;
		width: 100%;
		color: var(--clr-text);
	}

	:global([data-theme="dark"]) .light-icon {
		display: none;
	}

	:global([data-theme="dark"]) .dark-icon {
		display: inline;
	}
</style>

<script>
	// This scripts add the functionality to the theme toggle button and
	// update the theme in the local storage.

	document.addEventListener("astro:page-load", () => {
		const DARK_THEME = "dark";
		const LIGHT_THEME = "light";

		function handleToggleClick() {
			const element = document.documentElement;

			element.getAttribute("data-theme") === "light"
				? element.setAttribute("data-theme", "dark")
				: element.setAttribute("data-theme", "light");

			const isDark = element.getAttribute("data-theme") === "dark";
			localStorage.setItem("theme", isDark ? DARK_THEME : LIGHT_THEME);

			const theme = getTheme();
			updateThemeMessage(theme);
		}

		function getTheme(): string {
			if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
				return localStorage.getItem("theme") as string;
			}
			if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
				return DARK_THEME;
			}
			return LIGHT_THEME;
		}

		function updateThemeMessage(theme: string) {
			const translation = theme === DARK_THEME ? "dark" : "light";
			const actualThemeMsg = `Toggle theme, the current theme is ${translation}`;
			const span = document.querySelector("span.visually-hidden");
			if (span) {
				span.innerHTML = actualThemeMsg;
			}
		}

		const theme = getTheme();
		updateThemeMessage(theme);

		if (theme === LIGHT_THEME) {
			document.documentElement.setAttribute("data-theme", "light");
		} else {
			document.documentElement.setAttribute("data-theme", "dark");
		}

		window.localStorage.setItem("theme", theme);
		document.getElementById("themeToggle")?.addEventListener("click", handleToggleClick);
	});
</script>
