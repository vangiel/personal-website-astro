---
title: "Chatbot tutorial (Part 3) - Creating the chatbot component"
pubDate: "Jul 5 2024"
heroImage: "@/images/blog/Tutorials/1_Chatbot/frontmatter.png"
imageAlt: "Frontmatter of the page which consists of an AI generated image of a chatbot."
tags: ["Tutorials", "Web Development", "AI"]
slug: "tutorials/chatbot-part3"
---

import ChatBot from "@/components/ChatBot.astro";

<ChatBot />

Finally we can create the chatbot client component using Astro that will communciate with our previously created endpoint.
First we create a new file in the `src/components` directory named `ChatBot.astro`.

The html code includes two main elements, an ul with the list of messages and a form with the input field and the submit button.

```html
// src/components/ChatBot.astro
<aside class="chat closed">
	<button id="openChat">
		<Icon name="chat/chat-bubbles" />
	</button>
	<header class="chat-header">
		<Icon name="chat/chat-bubbles" />
		<h2>Chat with an AI</h2>
		<button id="closeChat">
			<Icon name="chat/close" />
		</button>
	</header>
	<ul id="messages">
		<li class="bot">
			<header>
				<h3>BOT</h3>
				<span>{date.getHours()}:{("00" + date.getMinutes()).slice(-2)}</span>
			</header>
			<p>Hi, welcome to my chat! I am a friendly assistant. Go ahead and send me a message. ðŸ˜„</p>
		</li>
	</ul>
	<form id="chatForm">
		<input id="message" type="text" autocomplete="off" />
		<button id="submitButton" type="submit">Send</button>
	</form>
</aside>
```

I also included some icons to open and close the chat and a first message to give some context to the user.
Now we add the tricky part, the javascript code to handle the form submission and the event listeners to handle the messages from the server.
Since CloudFlare models allow the streaming of data, we will use the [ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream) API to handle the data from the server.
Let's start by creating a new function to handle the form submission.

```typescript
// src/components/ChatBot.astro

import { $ } from "@/lib/dom-selector";
import type { ChatbotPayload } from "@/types/chatbot";

const date = new Date();

document.addEventListener("astro:page-load", () => {
	// Send new messages to the API chatbot that queries the AI model
	const $form: HTMLFormElement = $("#chatForm") as HTMLFormElement;
	const $input: HTMLInputElement = $("#message") as HTMLInputElement;
	const $messages = $("#messages") as HTMLElement;
	const $submitButton: HTMLButtonElement = $("#submitButton") as HTMLButtonElement;
	const messaggesMemory: ChatbotPayload[] = [
		{
			message: {
				content:
					"Hi, welcome to my chat! I am a friendly assistant. Go ahead and send me a message. ðŸ˜„",
				role: "assistant",
			},
		},
	];

	$form.addEventListener("submit", (e) => {
		e.preventDefault();

		// Update de chat
		// With the user input
		const $liUser = document.createElement("li");
		const $headerUser = document.createElement("header");
		const $pUser = document.createElement("p");
		const $liBot = document.createElement("li");
		const $headerBot = document.createElement("header");
		const $pBot = document.createElement("p");

		$headerUser.innerHTML = `<h3>User</h3><span>${date.getHours()}:${("00" + date.getMinutes()).slice(-2)}</span>`;
		$pUser.textContent = $input.value;

		$liUser.appendChild($headerUser);
		$liUser.appendChild($pUser);
		$liUser.classList.add("user");
		$messages.appendChild($liUser);

		// Send the user input to the API chatbot that queries the AI model
		const payload: ChatbotPayload = {
			message: {
				content: $input.value,
				role: "user",
			},
		};
		messaggesMemory.push(payload);

		fetch("/api/chatbot", {
			method: "POST",
			body: JSON.stringify(messaggesMemory),
			headers: {
				"Content-Type": "application/json",
			},
		});
		$input.value = "";
		$input.disabled = true;
		$submitButton.disabled = true;
	});
});
```
